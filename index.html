<!DOCTYPE html>
<html>
<head>
    <title>Fixed Crypto Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/bip39@3.0.4/bip39.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@5.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethereumjs-wallet@1.0.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.70.1/lib/index.iife.js"></script>
    <style>
        /* CSS đơn giản và hiệu quả */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        #scannerOutput {
            height: 400px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        button {
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .status {
            color: #666;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Working Crypto Scanner</h2>
        <div id="scannerOutput"></div>
        <button id="scanButton">Start Scan</button>
        <div class="status">
            Scanned: <span id="scanCount">0</span> | 
            Speed: <span id="scanSpeed">0</span>/sec | 
            Network: <span id="networkStatus">🟢 Online</span>
        </div>
    </div>

<script>
// ========== CẤU HÌNH HỆ THỐNG ==========
let isScanning = false;
let scanCounter = 0;
const API_ENDPOINTS = {
    BTC: addr => `https://blockchain.info/q/addressbalance/${addr}`,
    ETH: addr => `https://api.etherscan.io/api?module=account&action=balance&address=${addr}`,
    SOL: addr => `https://api.mainnet-beta.solana.com/`
};

// ========== HÀM QUÉT CHÍNH ==========
async function startScan() {
    while(isScanning) {
        try {
            // 1. Tạo cụm từ mới
            const phrase = generateMnemonic();
            
            // 2. Tạo các địa chỉ ví
            const addresses = await generateAddresses(phrase);
            
            // 3. Kiểm tra số dư
            const results = await checkBalances(addresses);
            
            // 4. Xử lý kết quả
            processResults(results, phrase);
            
            // 5. Cập nhật UI
            updateUI();
            
            // 6. Điều chỉnh tốc độ
            await new Promise(r => setTimeout(r, 5));
        } catch(error) {
            console.error('Lỗi quét:', error);
        }
    }
}

function generateMnemonic() {
    const entropy = new Uint8Array(16);
    crypto.getRandomValues(entropy);
    return bip39.entropyToMnemonic(entropy).split(' ');
}

async function generateAddresses(phrase) {
    const seed = await bip39.mnemonicToSeed(phrase.join(' '));
    return {
        BTC: generateBTCAddress(seed),
        ETH: generateETHAddress(seed),
        SOL: generateSOLAddress(seed)
    };
}

function generateBTCAddress(seed) {
    const root = bitcoin.bip32.fromSeed(seed);
    return root.derivePath("m/44'/0'/0'/0/0").address;
}

function generateETHAddress(seed) {
    const hdkey = ethereumjsWallet.hdkey.fromMasterSeed(seed);
    return hdkey.derivePath("m/44'/60'/0'/0/0").getWallet().getAddressString();
}

function generateSOLAddress(seed) {
    return solanaWeb3.Keypair.fromSeed(seed.slice(0, 32)).publicKey.toString();
}

async function checkBalances(addresses) {
    return {
        BTC: await checkBTCBalance(addresses.BTC),
        ETH: await checkETHBalance(addresses.ETH),
        SOL: await checkSOLBalance(addresses.SOL)
    };
}

async function checkBTCBalance(address) {
    try {
        const response = await fetch(API_ENDPOINTS.BTC(address));
        return parseInt(await response.text()) / 1e8;
    } catch {
        return 0;
    }
}

async function checkETHBalance(address) {
    try {
        const response = await fetch(API_ENDPOINTS.ETH(address));
        const data = await response.json();
        return data.result / 1e18;
    } catch {
        return 0;
    }
}

async function checkSOLBalance(address) {
    try {
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
        return await connection.getBalance(new solanaWeb3.PublicKey(address)) / 1e9;
    } catch {
        return 0;
    }
}

function processResults(results, phrase) {
    scanCounter++;
    const output = document.getElementById('scannerOutput');
    
    for(const [chain, balance] of Object.entries(results)) {
        if(balance > 0) {
            output.innerHTML = `
                <div style="color:green;">
                    [FOUND] ${chain}: ${balance} | Phrase: ${phrase.join(' ')}
                </div>
            ` + output.innerHTML;
            exportResult(chain, balance, phrase);
            stopScan();
            return;
        }
    }
    
    output.innerHTML = `
        <div style="color:gray;">
            [SCAN] BTC: ${results.BTC} | ETH: ${results.ETH} | SOL: ${results.SOL}
        </div>
    ` + output.innerHTML;
}

function updateUI() {
    document.getElementById('scanCount').textContent = scanCounter;
    document.getElementById('scanSpeed').textContent = Math.round(scanCounter / ((Date.now() - startTime)/1000));
}

function exportResult(chain, balance, phrase) {
    const content = `Chain: ${chain}\nBalance: ${balance}\nPhrase: ${phrase.join(' ')}`;
    const blob = new Blob([content], {type: 'text/plain'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'found_wallet.txt';
    link.click();
}

// ========== ĐIỀU KHIỂN QUÉT ==========
let startTime = Date.now();

function toggleScan() {
    isScanning = !isScanning;
    document.getElementById('scanButton').textContent = isScanning ? 'Stop Scan' : 'Start Scan';
    
    if(isScanning) {
        startTime = Date.now();
        scanCounter = 0;
        startScan();
    }
}

function stopScan() {
    isScanning = false;
    document.getElementById('scanButton').textContent = 'Start Scan';
}

// ========== EVENT LISTENERS ==========
document.getElementById('scanButton').addEventListener('click', toggleScan);

// Kiểm tra mạng
setInterval(() => {
    document.getElementById('networkStatus').textContent = navigator.onLine ? '🟢 Online' : '🔴 Offline';
}, 1000);
</script>
</body>
</html>
